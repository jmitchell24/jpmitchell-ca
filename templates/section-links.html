{% extends "base.html" %}

{% block content %}

{% set links = get_section(path="links/_index.md") %}

<section> 
    <section-title> 
        {% include "ionicons/link-outline.html" %}
        Links
    </section-title>   

    <section-nav>
        <a href="/">
            {% include "ionicons/arrow-undo-outline.html" %}
             Home
        </a>
    </section-nav>

    {% set links = load_data(path="links/links.toml") %}

    <section-content>    
        Links to good content that I found on the internet. Snapshots of each page are available through the links on the right. 

        {% set links_by_cat = links.links | group_by(attribute="cat") %}
        {% for cat, cat_links in links_by_cat %}

        <h3> {{ cat }} </h3>

        <link-list>
            {% set links_sorted = cat_links | sort(attribute="date") | reverse %}
            {% for it in links_sorted %}
            <link-item >
                <link-item-title data-external-href="{{it.url}}"> 
                    {{ it.title }} 
                </link-item-title>

                {% if it.arc %}
                <link-item-arc data-external-href="https://web.archive.org/web/{{it.arc}}/{{it.url}}"> 
                {% else %}
                <link-item-arc data-external-href="https://web.archive.org/web/*/{{it.url}}"> 
                {% endif %}

                    {% include "ionicons/archive-outline.html" %} 

                    <link-item-arc-time>
                    {{ it.date | date(format="%b. %d") }}
                    </link-item-arc-time>
                </link-item-arc>
            </link-item>
            {% endfor %}
            
        </link-list>
        {% endfor %}


    </section-content>
    
</section>

<script>
    document.querySelectorAll('*').forEach(item => {
        const url = item.getAttribute('data-external-href');
        if (url) { 
            item.setAttribute('title', url);
            item.addEventListener('click', (e) => {
                window.open(url, '_blank');
            });
            
            // Make it keyboard accessible
            item.setAttribute('tabindex', '0');
            item.setAttribute('role', 'link');
            item.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    item.click();
                }
            });
        }
    });
</script>

{% endblock content %}